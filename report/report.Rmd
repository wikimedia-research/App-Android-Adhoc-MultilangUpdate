---
title: Wikipedia Android app multilingual update
subtitle: Post-release report
author: Mikhail Popov
date: "`r sub('^0(\\d)', '\\1', format(Sys.Date(), '%d %B %Y'))`"

abstract: |
  On 25 June 2018, the Android team released a major update to the Wikipedia app that improved and extended support for multilingual users. It enables users to set multiple languages, to get parts of the Explore Feed in those languages, and switch between them when searching for articles...
  
  ----
  
  **Open report:** R code and RMarkdown source document are [publicly available](https://github.com/wikimedia-research/App-Android-Adhoc-MultilangUpdate) under a [Creative Commons Attribution-ShareAlike 4.0 International License](http://creativecommons.org/licenses/by-sa/4.0/).

output:
  memor::pdf_memo:
    use_profile: no
    logo: "../../wikimedia_foundation_logo.png"
    logo_height: "1.25in"
    number_sections: no
    fancy_captions: no
    libertine: no
    company:
      name: "\\href{https://www.mediawiki.org/wiki/Wikimedia_Audiences}{Wikimedia Audiences}"
      address: "\\href{https://www.mediawiki.org/wiki/Product_Analytics}{Product Analytics}"
      email: product-analytics@wikimedia.org
    includes:
      in_header: preamble.tex
    latex_engine: xelatex

bibliography: packages.bib
csl: apa.csl
nocite: '@*'

fontsize: 12pt
geometry: margin=1in
mainfont: "Source Serif Pro"
subparagraph: yes
---
```{r setup, include=FALSE}
library(knitr); library(kableExtra); library(here)
opts_chunk$set(
  echo = FALSE, message = FALSE, warning = FALSE,
  dev = "png", dpi = 600
)
options(knitr.table.format = "latex")
```
```{r utils}
source(here("report", "helpers.R"))
# Language code mapping, see https://meta.wikimedia.org/wiki/Special_language_codes
languages <- polloi::get_prefixes()[, c("language", "prefix")]
languages <- languages$language %>%
  stringi::stri_trans_general("latin-ascii") %>%
  set_names(languages$prefix)
languages <- c(languages, c(
  "zh-hans" = "Chinese (Simplified)", "zh-hant" = "Chinese (Traditional)",
  "be-x-old" = "Belarusian (Taraskievica)", "nb" = unname(languages["no"]),
  "test" = "Test", "en-x-piglatin" = "English Pig Latin")
)
```

\begin{figure}[t]
    \centering
    \begin{subfigure}[b]{0.3\textwidth}
        \frame{\includegraphics[width=\textwidth]{screenshots/onboarding.png}}
        \caption{System and keyboard languages are detected and suggested during onboarding for new users.}
        \label{fig:onboarding}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.3\textwidth}
        \frame{\includegraphics[width=\textwidth]{screenshots/feed.png}}
        \caption{Feed can now include cards (such as most read articles) in multiple languages.}
        \label{fig:feed}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.3\textwidth}
        \frame{\includegraphics[width=\textwidth]{screenshots/feed_customization.png}}
        \caption{Feed can be customized so certain cards show up in some languages but not others.}
        \label{fig:feed_customization}
    \end{subfigure}
    \caption{Screenshots of the Wikipedia Android app with the new, improved support for multilingual users.}\label{fig:screenshots}
\end{figure}

# Introduction

Following the research and design work of Rita Ho, the Android team released a major update to the Wikipedia app on 25 June 2018, which improved and extended support for multilingual users (see [T160567](https://phabricator.wikimedia.org/T160567) for more information). The updated features include:

- Users can not set multiple languages (previously they could only set one and would need to switch)
  - Users are prompted during onboarding (Fig. 1A)
  - Users can change their language settings from search and settings screens
- The Explore Feed can contain content in multiple languages (Fig. 1B)
- Users can customize which Explore Feed cards are enabled on a language-by-language basis (Fig. 1C)
- Users can switch between languages when searching for articles (Fig. 7)

The update also included analytics for the new and improved features (discussion and details documented in [T190931](https://phabricator.wikimedia.org/T190931)). During onboarding (and later in settings) users can opt out of sharing usage data, so the analysis in this report relies on data from those analytics-enrolled users. Furthermore, certain schemas/funnels use different sampling rates -- some at 100%, some at 10%, and some at 1% -- and in cases where the sampling rate is lower than 100% we refer to those users as a random sample or having been randomly selected.

# Results

```{r data}
# Language settings & searching
language_settings <- readr::read_rds(here("data", "language_settings.rds"))
language_searching <- readr::read_rds(here("data", "language_searching.rds"))
# Sessions
sessions <- readr::read_rds(here("data", "sessions.rds")) %>%
  mutate(
    language_ability = lang_ability(n_languages),
    fct_pages_viewed = factor(
      dplyr::if_else(total_pages < 5, total_pages, 5),
      levels = c(0:5),
      labels = c(0:4, "5+")
    )
  )
# Explore Feed
feed_customization <- readr::read_rds(here("data", "feed_customization.rds")) %>%
  mutate(
    n_languages = map_int(languages, length),
    language_ability = lang_ability(n_languages),
    enabled_counts = map(enabled_list, ~ lapply(.x, length)),
    all_same = map_lgl(enabled_counts, ~ length(unique(.x)) == 1)
  )
feed_sessions <- readr::read_rds(here("data", "feed_sessions.rds"))
card_clickthroughs <- readr::read_rds(here("data", "card_clickthroughs.rds"))
# Searching
search_langswitches <- readr::read_rds(here("data", "search_langswitches.rds"))
search_sessions <- readr::read_rds(here("data", "search_sessions.rds"))
```

```{r sessions_summary, cache=TRUE}
session_streaks <- sessions %>%
  mutate(date = as.Date(client_dt)) %>%
  group_by(app_install_id, date) %>%
  tally() %>%
  mutate(
    diff = c(0, abs(date[-n()] - date[-1])),
    streak = cumsum(diff != 1) # grouping consecutive days
  ) %>%
  summarize(
    n_days = n(),
    avg_sessions_per_day = mean(n),
    longest_streak = max(table(streak))
  )
session_reading <- sessions %>%
  group_by(app_install_id) %>%
  summarize(
    avg_pages_viewed = ceiling(mean(total_pages)),
    med_pages_viewed = ceiling(median(total_pages)),
    fct_avg_pages_viewed = factor(
      dplyr::if_else(avg_pages_viewed < 5, avg_pages_viewed, 5),
      levels = c(0:5),
      labels = c(0:4, "5+")
    ),
    fct_med_pages_viewed = factor(
      dplyr::if_else(med_pages_viewed < 5, med_pages_viewed, 5),
      levels = c(0:5),
      labels = c(0:4, "5+")
    ),
    med_session_length = ceiling(median(session_length)),
    avg_session_length = ceiling(mean(session_length)),
    sessions = n()
  )
session_summary <- sessions %>%
  group_by(app_install_id) %>%
  top_n(1, client_dt) %>%
  ungroup %>%
  select(app_install_id, languages, n_languages, language_ability) %>%
  left_join(session_streaks, by = "app_install_id") %>%
  left_join(session_reading, by = "app_install_id")
rm(session_streaks, session_reading)
```

```{r top_languages}
top_languages <- session_summary %>%
  select(app_install_id, langs = languages) %>%
  mutate(langs = map(langs, ~ languages[.x])) %>%
  {
    purrr::map_df(
      set_names(.$langs, .$app_install_id),
      ~ dplyr::as_data_frame(.x),
      .id = "app_install_id"
    )
  } %>%
  group_by(app_install_id) %>%
  mutate(
    n_langs = n(),
    n_langs = ifelse(n_langs > 4, 5, n_langs),
    n_langs = factor(n_langs, 1:5, c(1:4, "5+"))
  ) %>%
  group_by(n_langs, lang = value) %>%
  tally() %>%
  mutate(prop = n / sum(n)) %>%
  select(-n)
top_20_languages <- top_languages %>%
  group_by(n_langs) %>%
  top_n(10, prop) %>%
  mutate(prop = percent(prop))
top_20_languages %>%
  spread(n_langs, prop, fill = "--") %>%
  arrange(lang) %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  set_rownames(.$lang) %>%
  select(-lang) %>%
  kable(
    booktabs = TRUE, align = "r",
    caption = "Prevalence of languages among users who read in 1-5 or more languages. Within each group (by number of languages), the top 10 languages were selected. Those languages were then combined into an overall list. For example, users who read in Swedish make up 1.1\\% of monolingual users and Swedish is not used in conjunction with any other language. Users who have set Chinese (simplified and traditional) have only done so in conjunction with one or more other languages such as English or each other, but not by themselves."
  ) %>%
  add_header_above(c("", "Within users who read in this number of languages" = 5)) %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```

## Language settings

```{r final_settings}
final_settings <- language_settings %>%
  group_by(app_install_id) %>%
  top_n(1, client_dt) %>%
  ungroup
```

```{r language_combinations}
language_combinations <- final_settings %>%
  keep_where(n_final > 1) %>%
  mutate(
    languages = map_chr(
      final,
      ~ paste(sort(languages[.x]), collapse = ", ")
    ),
    n_final = factor(ifelse(n_final >= 3, 3, n_final), 2:3, c("2", "3+"))
  ) %>%
  group_by(n_final, languages) %>%
  tally() %>%
  mutate(prop = n / sum(n)) %>%
  top_n(5, n) %>%
  select(-n) %>%
  ungroup %>%
  arrange(n_final, desc(prop))
language_combinations %>%
  mutate(prop = percent2(prop, 1)) %>%
  select(Languages = languages, `Proportion of bi/multilingual users` = prop) %>%
  kable(
    booktabs = TRUE, align = c("l", "r"),
    caption = "Top five (unordered) language combinations (2 and 3+ separately)."
  ) %>%
  group_rows_v2("2 languages", which(language_combinations$n_final == "2")) %>%
  group_rows_v2("3+ languages", which(language_combinations$n_final == "3+")) %>%
  kable_styling(latex_options = "hold_position")
```

```{r langset_breakdown}
langset_breakdown <- final_settings %>%
  mutate(langs = factor(ifelse(n_final < 5, n_final, "5+"), c(1:4, "5+"))) %>%
  group_by(langs) %>%
  tally() %>%
  mutate(prop = n / sum(n)) %>%
  as.data.frame() %>%
  set_rownames(.$langs)
langset_breakdown %>%
  select(-n) %>%
  spread(langs, prop) %>%
  map_df(percent) %>%
  as.data.frame() %>%
  set_rownames("Approximate % of users") %>%
  kable(
    booktabs = TRUE, align = rep("r", 5),
    caption = "Breakdown of users by number of languages they have in their settings."
  ) %>%
  add_header_above(c(" ", "Number of languages" = 5)) %>%
  kable_styling(latex_options = "hold_position")
```

Among a random sample of users who have updated the app to at least [version 2.7.24x](https://phabricator.wikimedia.org/project/profile/3317/) from [Google Play Store](https://play.google.com/store/apps/details?id=org.wikipedia) and engaged with the language settings (either changed or left them as-is), `r percent(langset_breakdown["1", "prop"])` are monolingual, `r percent(langset_breakdown["2", "prop"])` are bilingual, and `r percent(langset_breakdown["3", "prop"] + langset_breakdown["4", "prop"] + langset_breakdown["5+", "prop"])` are multilingual (3 or more languages).

```{r langsesh_breakdown}
langsesh_breakdown <- session_summary %>%
  group_by(language_ability) %>%
  tally() %>%
  mutate(prop = n / sum(n)) %>%
  as.data.frame() %>%
  set_rownames(.$language_ability)
```

However, of `r compress(sum(langsesh_breakdown$n), 1)` randomly-selected users who have used the new version of the app, `r percent(langsesh_breakdown["Monolingual", "prop"])` are monolingual, `r percent(langsesh_breakdown["Bilingual", "prop"])` are bilingual, and `r percent(langsesh_breakdown["Multilingual (3+)", "prop"])` are multilingual (3 or more languages).

```{r onboarding_summary}
onboarding_summary <- language_settings %>%
  keep_where(source == "onboarding") %>%
  group_by(app_install_id) %>%
  summarize(
    removed = any(removed),
    added = any(added),
    changed_primary = any(changed_primary)
  ) %>%
  summarize(
    n_users = n(),
    n_removed = sum(removed),
    n_added = sum(added),
    n_changed = sum(changed_primary)
  ) %>%
  gather(action, users, -n_users) %>%
  mutate(prop = users / n_users) %>%
  select(-users) %>%
  spread(action, prop) %>%
  as_vector
```

During onboarding, when the app detects languages from the user's system and keyboard settings and suggests them to the user (see Fig. 1A), of `r onboarding_summary['n_users']` sampled users, `r percent(onboarding_summary['n_removed'])` removed 1 or more languages, `r percent(onboarding_summary['n_added'])` added 1 or more languages, and `r percent(onboarding_summary['n_changed'])` changed their primary language.

## Reading behavior

Currently, when a user stop using the app for more than 30 minutes (with basically any interaction with the app counting as usage), then we consider the current session as over, and send the summary of that session once the user interacts with the app again.

```{r, fig.cap="Distribution of average session length per user by language ability.", fig.height=7}
ggplot(
  session_summary %>%
    keep_where(avg_session_length > 0) %>%
    group_by(language_ability) %>%
    mutate(rand = runif(n())) %>%
    top_n(table(session_summary$language_ability)["Bilingual"], rand),
  aes(y = avg_session_length, x = language_ability)
) +
  ggforce::geom_sina(
    aes(color = language_ability),
    size = 1, scale = FALSE,
    adjust = 0.5
  ) +
  scale_color_brewer(palette = "Set1") +
  scale_y_log10(
    breaks = c(1, 10, c(0.5, 1, 5, 10, 15, 30, 60) * 60),
    labels = seconds_to_duration
  ) +
  labs(
    title = "Average session length per user",
    y = "Duration", x = NULL, color = "Language ability"
  ) +
  wmf::theme_min(14, "Source Sans Pro")
```

```{r aspd_quantiles, fig.width=10, fig.height=10, fig.cap="Distribution of average number of sessions per day by language ability, with percentiles."}
aspd_quantiles <- session_summary %>%
  { split(.$avg_sessions_per_day, .$language_ability) } %>%
  map(quantile, probs = c(0.5, 0.8, 0.95, 0.99)) %>%
  map(as.data.frame) %>%
  map_df(function(x) {
    colnames(x) <- "avg_sessions_per_day"
    x$percentile <- rownames(x)
    return(set_rownames(x, NULL))
  }, .id = "la") %>%
  mutate(language_ability = factor(la, c("Monolingual", "Bilingual", "Multilingual (3+)")))
session_summary %>%
  keep_where(avg_sessions_per_day <= 16) %>%
  ggplot(aes(x = avg_sessions_per_day)) +
  geom_density(aes(fill = language_ability), color = NA) +
  facet_wrap(~ language_ability, ncol = 1, scale = "free_y") +
  geom_linerange(
    aes(ymin = 0, ymax = 0.4),
    size = 1, data = aspd_quantiles
  ) +
  geom_label(
    aes(y = 0.2, label = sub("%", "th", percentile, fixed = TRUE)),
    label.size = 0.5, data = aspd_quantiles
  ) +
  geom_label(
    aes(
      y = 0.4, color = language_ability,
      label = sprintf("%.1f", avg_sessions_per_day)
    ),
    label.size = 0.5, data = aspd_quantiles
  ) +
  scale_color_brewer(palette = "Set1", guide = FALSE) +
  scale_fill_brewer(palette = "Set1") +
  scale_x_continuous(breaks = 1:16) +
  labs(
    title = "Average sessions per user per day",
    x = "Sessions/day", y = NULL, color = "Language ability", fill = "Language ability"
  ) +
  wmf::theme_facet(
    22, "Source Sans Pro",
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.y = element_blank()
  )
```

```{r, fig.cap='For each number of pages, the +/- percentages are relative to proportion of monolingual users who, on average, read that many pages per session.', fig.width=10, fig.height=6}
session_summary %>%
  mutate(
    n_days = ifelse(n_days >= 10, 10, n_days),
    n_days = factor(n_days, 1:10, c(1:9, "10+"))
  ) %>%
  group_by(status = language_ability, n_days) %>%
  tally() %>%
  mutate(prop = n / sum(n)) %>%
  ungroup %>%
  select(-n) %>%
  mono_relative(n_days) %>%
  ggplot(aes(x = n_days, y = prop, fill = status)) +
  geom_bar(position = position_dodge2(width = 1), stat = "identity") +
  geom_text(
    aes(label = percent2(relative, 0, add_plus = TRUE), y = prop + 0.005),
    position = position_dodge2(width = 1),
    hjust = "middle", vjust = "bottom",
  ) +
  scale_y_continuous(labels = percent) +
  scale_fill_brewer(palette = "Set1") +
  labs(
    title = "Number of days a user used the app during the first 2 weeks following update's release",
    y = "Proportion of users",
    x = "Days",
    fill = "Language ability"
  ) +
  wmf::theme_min(14, "Source Sans Pro")
```

```{r, fig.cap='For each number of pages, the +/- percentages are relative to proportion of monolingual users who, on average, read that many pages per session.', fig.width=10, fig.height=6}
session_summary %>%
  mutate(
    longest_streak = ifelse(longest_streak >= 7, 7, longest_streak),
    longest_streak = factor(longest_streak, 1:7, c(paste(1:6, "day(s)"), "1 week or longer"))
  ) %>%
  group_by(status = language_ability, longest_streak) %>%
  tally() %>%
  mutate(prop = n / sum(n)) %>%
  ungroup %>%
  select(-n) %>%
  mono_relative(longest_streak) %>%
  ggplot(aes(x = longest_streak, y = prop, fill = status)) +
  geom_bar(position = position_dodge2(width = 1), stat = "identity") +
  geom_text(
    aes(label = percent2(relative, 0, add_plus = TRUE), y = prop + 0.005),
    position = position_dodge2(width = 1),
    hjust = "middle", vjust = "bottom",
  ) +
  scale_y_continuous(labels = percent) +
  scale_fill_brewer(palette = "Set1") +
  labs(
    title = "...",
    y = "Proportion of users",
    x = "Consecutive daily usage",
    fill = "Longest streak of consecutive daily app usage"
  ) +
  wmf::theme_min(14, "Source Sans Pro")
```

```{r pages_viewed, fig.cap='For each number of pages, the +/- percentages are relative to proportion of monolingual users who, on average, read that many pages per session.', fig.width=10}
pages_viewed <- session_summary %>%
    group_by(status = language_ability, pages = fct_med_pages_viewed) %>%
    group_props %>%
    mono_relative(pages)
ggplot(pages_viewed, aes(fill = status, x = pages, y = prop)) +
  geom_bar(position = position_dodge2(width = 1), stat = "identity") +
  geom_text(
    aes(label = percent2(relative, 0, add_plus = TRUE), y = prop + 0.01),
    position = position_dodge2(width = 1),
    hjust = "middle", vjust = "bottom",
  ) +
  scale_y_continuous(labels = percent) +
  scale_fill_brewer(palette = "Set1") +
  labs(
    title = "Users who read in multiple languages tend to read more",
    y = "Proportion of users", x = "Median pages viewed per session", fill = "Language ability"
  ) +
  wmf::theme_min(14, "Source Sans Pro")
```

## Explore Feed

### Customization

Based on the random sample of `r compress(length(unique(sort(feed_customization$app_install_id))), 3)` users from the feed customization analytics, there were `r nrow(dplyr::distinct(keep_where(feed_customization, !all_same), app_install_id))` users who customized their feed such that certain cards would be shown in some languages but not others. Users hide cards, but not for specific languages (where possible). Either users are not as aware of this feature as we would we would have hoped (more likely), or they really do want to see the cards in all the languages they have set (less likely). During onboarding -- including an additional notice in their feed -- we let users know that they can customize what is shown and how types of content are prioritized, but not that they can hide/show on a per-language basis.

```{r feed_abilities}
feed_abilities <- feed_customization %>%
  group_by(app_install_id) %>%
  top_n(1, client_dt) %>%
  ungroup %>%
  select(app_install_id, language_ability)
```

```{r feed_customizations}
relevant_cards <- c("In the news", "On this day", "Trending", "Featured article")
feed_customizations <- feed_customization %>%
  group_by(app_install_id) %>%
  top_n(1, client_dt) %>%
  ungroup %>%
  {
    purrr::map_df(
      set_names(.$enabled_list_v2, .$app_install_id),
      ~ dplyr::as_data_frame(.x[relevant_cards[relevant_cards %in% names(.x)]]),
      .id = "app_install_id"
    )
  }
```

```{r card_language_combinations, eval=FALSE}
card_language_combinations <- feed_customizations %>%
  gather(card, language, -app_install_id) %>%
  keep_where(!is.na(language)) %>%
  mutate(
    language = languages[language]
  ) %>%
  group_by(app_install_id, card) %>%
  summarize(
    language_combo = paste0(sort(language), collapse = ", "),
    language_combo_v2 = paste0(setdiff(sort(language), "English"), collapse = ", "),
    has_english = "English" %in% language,
    n_languages = n(), n_languages_v2 = n() - has_english
  ) %>%
  ungroup
```

### Engagement

```{r available_in_other_languages}
available_in_other_languages <- c(
  "continue reading" = NA, # depends on primary language
  "\"because you read\" list" = FALSE, # english only
  "\"most read\" list" = TRUE, # trending
  "featured article card" = TRUE,
  "random card" = FALSE,
  "main page card" = FALSE, # today on wikipedia
  "news list" = TRUE,
  "featured image card" = FALSE,
  "\"because you read\" item" = FALSE, # english only
  "\"most read\" item" = TRUE,
  "news item" = TRUE,
  "news item link" = TRUE,
  "on this day card" = TRUE,
  "onboarding - customize feed" = FALSE,
  "onboarding - reading list sync" = FALSE
)
```

```{r}
card_clickthroughs %>%
  keep_where(!card_type %in% c("day header", "continue reading")) %>%
  dplyr::inner_join(feed_abilities, by = "app_install_id") %>%
  mutate(language_availability = available_in_other_languages[card_type]) %>%
  group_by(language_availability, language_ability) %>%
  summarize(ctr = percent(mean(clickthrough))) %>%
  ungroup %>%
  mutate(cards = dplyr::if_else(
    language_availability,
    "Multilingual-enabled cards CTR",
    "Other (i.e. English-only) cards CTR"
  )) %>%
  select(-language_availability) %>%
  spread(cards, ctr) %>%
  rename(`Language ability` = language_ability) %>%
  kable(
    booktabs = TRUE, align = c("l", "r", "r"),
    caption = "Engagement with Feed cards by language ability and whether the cards are language-customizable (e.g. 'In the news') or not -- including cards which are language-agnostic such as onboarding cards and cards which are only available in English, such as 'Because you read'."
  ) %>%
  kable_styling(latex_options = "hold_position")
```

```{r feed_engagement}
feed_engagement <- card_clickthroughs %>%
  keep_where(!card_type %in% c("day header")) %>%
  dplyr::inner_join(feed_abilities, by = "app_install_id") %>%
  mutate(
    language_availability = available_in_other_languages[card_type],
    card_type = polloi::capitalize_first_letter(gsub("\"", "", card_type, fixed = TRUE)),
    card_type = sub(" Card", "", card_type, fixed = TRUE)
  ) %>%
  group_by(card_type, language_availability, language_ability) %>%
  summarize(ctr = percent(mean(clickthrough))) %>%
  ungroup %>%
  spread(language_ability, ctr) %>%
  arrange(language_availability, card_type) %>%
  rename(`Feed cards by multilingual support` = card_type)
feed_engagement %>%
  select(-language_availability) %>%
  kable(
    booktabs = TRUE, align = c("l", "r", "r", "r"),
    caption = "Explore Feed engagement (clickthrough rates) by card type, multilingual support (whether the card is available in English only or in other languages), and user's language settings (1, 2, and 3+ languages)."
  ) %>%
  add_header_above(c(" " = 1, "Engagement among users who are" = 3)) %>%
  group_rows_v2("Where available", which(feed_engagement$language_availability)) %>%
  group_rows_v2("None (English only)", which(!feed_engagement$language_availability)) %>%
  group_rows_v2("N/A (depends on primary)", which(is.na(feed_engagement$language_availability))) %>%
  kable_styling(latex_options = "hold_position")
```

## Searching behavior

\begin{figure}[ht]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
        \frame{\includegraphics[width=\textwidth]{screenshots/search_en.png}}
        \caption{English search results}
        \label{fig:search_en}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.45\textwidth}
        \frame{\includegraphics[width=\textwidth]{screenshots/search_ru.png}}
        \caption{Russian search results}
        \label{fig:search_ru}
    \end{subfigure}
    \caption{Screenshots showing that users can switch between languages when searching Wikipedia.}\label{fig:searching}
\end{figure}

```{r search_switch_prop}
search_switch_prop <- search_sessions %>%
  keep_where(
    app_install_id %in% session_summary$app_install_id
  ) %>%
  left_join(session_summary[, c("app_install_id", "language_ability")], by = "app_install_id") %>%
  keep_where(language_ability != "Monolingual") %>%
  summarize(prop = mean(language_switches > 0)) %>%
  { .[[1]] }
```

Among users who read in more than one language, `r percent(search_switch_prop)` switch languages when searching.

```{r search_engagement}
search_sessions %>%
  keep_where(saw_results) %>%
  group_by(app_install_id) %>%
  summarize(
    switched_languages = any(language_switches > 0),
    ctr = mean(clicked), ar = mean(abandoned),
    clicked = any(clicked), abandoned = any(abandoned)
  ) %>%
  mutate(switched_languages = dplyr::if_else(switched_languages, "Switched languages", "Did not switch languages")) %>%
  group_by(`When searching` = switched_languages) %>%
  summarize(
    `Overall CTR` = percent(mean(clicked)), # |users who clicked|/|users|
    `CTR per user` = percent(mean(ctr)),
    `Overall AR` = percent(mean(abandoned)), # |users who abandoned|/|users|
    `AR per user` = percent(mean(ar))
  ) %>%
  kable(
    booktabs = TRUE, align = c("l", "r", "r", "r", "r"),
    caption = "Average \\textit{clickthrough rate} (CTR) and \\textit{abandonment rate} (AR) among searchers, by whether they switched languages when searching."
  ) %>%
  kable_styling(latex_options = "hold_position")
```

We see a higher search abandonment rate among users who switched languages most likely because one of the reasons for switching languages is because they did not find a relevant result in one language.

# Conclusion

# Acknowledgements

This report was created using the statistical software and programming language **R** [-@base]. Data collection relied on the excellent work of the [Mobile Apps](https://www.mediawiki.org/wiki/Wikimedia_Apps/Team) -- especially the instrumentation work of Sharvani Haran -- and data pipelines developed by [Analytics Engineering](https://wikitech.wikimedia.org/wiki/Analytics) teams.

\newpage

# References

\footnotesize
